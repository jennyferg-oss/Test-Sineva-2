<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sineva Competency & Personality Assessment</title>

  <!-- ====== CORPORATE PREMIUM STYLES (INLINE) ====== -->
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap');

    :root{
      --brand: #16a34a;
      --brand-2: #22c55e;
      --brand-3: #0f766e;
      --ink: #0b1220;
      --muted: #637086;
      --bg: #f4f7fb;
      --bg-2: #eef2f7;
      --card: #ffffff;
      --line: #e6ebf2;
      --radius: 16px;
      --shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
      --shadow-strong: 0 16px 50px rgba(15, 23, 42, 0.12);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:"Inter", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      background:
        radial-gradient(900px 500px at 10% -10%, rgba(34,197,94,.12), transparent 55%),
        radial-gradient(900px 600px at 100% 0%, rgba(15,118,110,.10), transparent 55%),
        linear-gradient(180deg, var(--bg), var(--bg-2));
      min-height:100vh;
    }

    .bg-orbs{
      position:fixed; inset:0; pointer-events:none; opacity:.7;
      background:
        radial-gradient(500px 350px at 12% 12%, rgba(22,163,74,.12), transparent 60%),
        radial-gradient(600px 420px at 70% 8%, rgba(34,197,94,.10), transparent 62%),
        radial-gradient(700px 700px at 85% 85%, rgba(14,165,233,.08), transparent 60%);
      filter:blur(16px);
    }

    .app{
      width:min(1120px, 94vw);
      margin:18px auto 40px;
      position:relative;
    }

    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 12px; margin-bottom:10px;
    }

    .brand{display:flex; align-items:center; gap:12px;}
    .logo{
      width:52px; height:52px; border-radius:14px;
      background:linear-gradient(135deg, var(--brand), var(--brand-2));
      display:grid; place-items:center; font-weight:900; font-size:20px;
      color:#fff; box-shadow:0 10px 30px rgba(22,163,74,.35);
    }
    .brand h1{margin:0; font-size:22px;}
    .brand p{margin:2px 0 0; color:var(--muted); font-size:13px;}

    .timer{
      background:#fff; border:1px solid var(--line);
      padding:8px 12px; border-radius:12px;
      display:flex; flex-direction:column; align-items:flex-end;
      box-shadow:var(--shadow); min-width:120px;
    }
    .timer-label{font-size:11px; color:var(--muted);}
    .timer-value{font-size:18px; font-weight:800; color:#081325;}

    .screen{display:none;}
    .screen.active{display:block;}
    .hidden{display:none !important;}

    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:20px;
      box-shadow:var(--shadow);
    }

    h2{margin:0 0 6px; font-size:26px;}
    h3{margin:18px 0 8px; font-size:18px;}
    .muted{color:var(--muted);}

    .form-grid{
      display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px; margin-top:12px;
    }
    .form-grid label{
      display:flex; flex-direction:column; font-size:13px; gap:6px; font-weight:600;
      color:#0c1a33;
    }
    .form-grid input{
      padding:11px 12px; border-radius:12px;
      border:1px solid var(--line);
      background:#fff; color:var(--ink);
      outline:none; font-size:14px; transition:.12s ease;
    }
    .form-grid input:focus{
      border-color:var(--brand);
      box-shadow:0 0 0 4px rgba(22,163,74,.12);
    }
    .checkbox{
      grid-column:1/-1; flex-direction:row !important; align-items:center; gap:8px;
      font-weight:500; color:var(--muted);
    }
    .checkbox input{width:18px; height:18px;}

    .actions{display:flex; gap:10px; margin-top:14px; flex-wrap:wrap;}
    .btn{
      padding:10px 14px; border-radius:12px;
      border:1px solid transparent; font-weight:700; cursor:pointer;
      transition:.12s ease; font-size:14px;
      background:#fff; color:#0c1a33; border-color:var(--line);
    }
    .btn:hover{transform:translateY(-1px); box-shadow:var(--shadow);}
    .btn.primary{
      background:linear-gradient(135deg, var(--brand), var(--brand-2));
      color:white; border:none; box-shadow:0 10px 25px rgba(22,163,74,.25);
    }
    .btn.ghost{background:#fff; border-color:var(--line); color:#0c1a33;}
    .btn.danger{background:#fff; border-color:#fecaca; color:#b91c1c;}

    .preview{
      margin-top:14px; display:grid; grid-template-columns:repeat(5,1fr); gap:10px;
    }
    .preview .pill{
      padding:12px; border-radius:12px;
      background:#f8fafc; border:1px dashed var(--line);
      font-size:13px; color:var(--muted);
    }

    .test-header{
      display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
    }
    .progress{display:flex; align-items:center; gap:10px;}
    .progress-bar{
      width:260px; height:10px; background:#eef2f7;
      border-radius:999px; overflow:hidden; border:1px solid var(--line);
    }
    .progress-fill{
      height:100%; width:0%;
      background:linear-gradient(90deg, var(--brand), #3b82f6);
      transition:width .2s ease;
    }
    .progress-text{font-size:13px; color:var(--muted); min-width:44px;}

    .question-wrap{margin-top:10px; display:grid; gap:12px;}
    .q-card{
      padding:16px; border-radius:14px; background:#f9fbff;
      border:1px solid var(--line);
    }
    .q-meta{
      display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;
    }
    .q-num{
      font-weight:800; font-size:12px; color:#0f5132;
      background:rgba(22,163,74,.10); padding:4px 8px; border-radius:999px;
    }
    .q-tag{
      font-size:12px; color:var(--muted);
      border:1px solid var(--line); padding:3px 7px; border-radius:999px; background:#fff;
    }
    .q-text{
      font-size:16px; line-height:1.45; margin:4px 0 12px; color:#0c1a33;
    }

    .scale{
      display:grid; grid-template-columns:repeat(5,1fr); gap:8px;
    }
    .scale button{
      padding:10px 8px; border-radius:12px;
      border:1px solid var(--line); background:#fff; color:#0c1a33;
      font-weight:700; font-size:12px; cursor:pointer; min-height:48px; transition:.12s ease;
    }
    .scale button:hover{
      border-color:var(--brand);
      box-shadow:0 0 0 3px rgba(22,163,74,.10);
      transform:translateY(-1px);
    }
    .scale button.selected{
      border-color:var(--brand);
      background:rgba(22,163,74,.08);
      box-shadow:0 0 0 3px rgba(22,163,74,.12);
    }

    .nav{display:flex; justify-content:space-between; margin-top:14px;}

    .results-header{
      display:flex; justify-content:space-between; align-items:flex-start; gap:12px; flex-wrap:wrap;
    }
    .results-grid{
      display:grid; grid-template-columns:repeat(2,1fr); gap:12px; margin-top:8px;
    }
    .result-card{
      padding:16px; border-radius:14px; background:#fff;
      border:1px solid var(--line); box-shadow:var(--shadow);
    }
    .result-head{display:flex; justify-content:space-between; align-items:center;}
    .result-title{font-weight:800; color:#0c1a33;}
    .result-score{font-weight:900; color:#0c1a33;}

    .result-bar{
      margin-top:8px; height:10px; background:#eef2f7;
      border-radius:999px; overflow:hidden; border:1px solid var(--line);
    }
    .result-bar > div{
      height:100%; width:0%;
      background:linear-gradient(90deg, #60a5fa, var(--brand));
    }

    .result-explain{margin-top:8px; font-size:14px; color:#243041; line-height:1.5;}

    .note{
      margin-top:14px; padding:12px; border-radius:12px;
      background:rgba(22,163,74,.08); border:1px solid rgba(22,163,74,.25);
      color:#0f5132; font-size:14px;
    }

    .modal{
      position:fixed; inset:0; display:grid; place-items:center;
      background:rgba(15,23,42,.45); z-index:50;
    }
    .modal-card{
      width:min(420px, 92vw); background:#fff;
      padding:18px; border-radius:16px; border:1px solid var(--line);
      box-shadow:var(--shadow-strong); text-align:center;
    }

    .footer{margin-top:14px; text-align:center; font-size:12px; color:var(--muted);}

    @media (max-width:900px){
      .form-grid{grid-template-columns:1fr;}
      .results-grid{grid-template-columns:1fr;}
      .progress-bar{width:180px;}
      .preview{grid-template-columns:1fr 1fr;}
    }
  </style>
</head>

<body>
  <div class="bg-orbs"></div>

  <main class="app">

    <!-- HEADER -->
    <header class="topbar">
      <div class="brand">
        <div class="logo">S</div>
        <div>
          <h1>Sineva Assessment</h1>
          <p>Competencies + Big Five Personality</p>
        </div>
      </div>
      <div class="timer hidden" id="timerWrap">
        <span class="timer-label">Elapsed</span>
        <span class="timer-value" id="timer">00:00</span>
      </div>
    </header>

    <!-- START SCREEN -->
    <section id="startScreen" class="card screen active">
      <h2>Welcome!</h2>
      <p class="muted">
        Please complete this assessment in one sitting.  
        Your results help us understand your strengths, working style, and role alignment.
      </p>

      <form id="candidateForm" class="form-grid">
        <label>
          Full name
          <input required type="text" id="fullName" placeholder="e.g., Alex Johnson"/>
        </label>
        <label>
          Role you are applying for
          <input required type="text" id="role" placeholder="e.g., Sales Manager"/>
        </label>
        <label>
          Email
          <input required type="email" id="email" placeholder="e.g., alex@email.com"/>
        </label>

        <label class="checkbox">
          <input required type="checkbox" id="consent"/>
          <span>I understand that leaving this page will restart the test.</span>
        </label>
      </form>

      <div class="actions">
        <button id="startBtn" class="btn primary">Start Assessment</button>
        <button id="previewBtn" class="btn ghost">Preview Modules</button>
      </div>

      <div id="modulesPreview" class="preview hidden"></div>
    </section>

    <!-- TEST SCREEN -->
    <section id="testScreen" class="screen hidden">
      <div class="card">
        <div class="test-header">
          <div>
            <h2 id="moduleTitle"></h2>
            <p id="moduleDesc" class="muted"></p>
          </div>

          <div class="progress">
            <div class="progress-bar">
              <div id="progressFill" class="progress-fill"></div>
            </div>
            <span id="progressText" class="progress-text">0/50</span>
          </div>
        </div>

        <div id="questionWrap" class="question-wrap"></div>

        <div class="nav">
          <button id="prevBtn" class="btn ghost">Back</button>
          <button id="nextBtn" class="btn primary">Next</button>
        </div>
      </div>
    </section>

    <!-- RESULTS SCREEN -->
    <section id="resultsScreen" class="screen hidden">
      <div class="card">
        <div class="results-header">
          <div>
            <h2>Results</h2>
            <p class="muted" id="candidateSummary"></p>
          </div>
          <div class="actions">
            <button id="downloadHtmlBtn" class="btn primary">Download Results</button>
            <button id="downloadJsonBtn" class="btn ghost">Download JSON</button>
            <button id="restartBtn" class="btn danger">Restart</button>
          </div>
        </div>

        <h3>Competencies (100% = ideal benchmark)</h3>
        <div id="competencyResults" class="results-grid"></div>

        <h3>Big Five Personality (expression level, not “good or bad”)</h3>
        <div id="personalityResults" class="results-grid"></div>

        <div class="note">
          <strong>Note:</strong> High or low personality scores are not automatically positive or negative.
          We interpret them as style indicators that help match you to the role and team.
        </div>
      </div>
    </section>

    <!-- LEAVE PAGE MODAL -->
    <div id="resetModal" class="modal hidden">
      <div class="modal-card">
        <h3>Test Restarted</h3>
        <p>
          You left the page or switched tabs.  
          As stated, the assessment must restart to keep results fair.
        </p>
        <button id="modalOkBtn" class="btn primary">OK</button>
      </div>
    </div>

    <footer class="footer muted">
      © Sineva Group — Internal Recruitment Assessment
    </footer>
  </main>

  <!-- ====== JAVASCRIPT (INLINE) ====== -->
  <script>
    const MODULES = [
      {
        id: "innovation",
        title: "Module 1 — Innovation",
        desc: "How you explore ideas, challenge assumptions, and create value.",
        questions: [
          { text: "Your team is stuck using a process that works 'well enough' but wastes time. What do you do first?", type:"scenario", competency:"innovation", bigFive:["O"], reverse:false },
          { text: "I often notice patterns or opportunities others miss, even if they aren’t obvious at first.", type:"likert", competency:"innovation", bigFive:["O"], reverse:false },
          { text: "A client asks for a solution you’ve never built before and the timeline is tight. You:", type:"scenario", competency:"innovation", bigFive:["C"], reverse:false },
          { text: "I prefer improving existing ideas rather than proposing something totally new. (Subtle)", type:"likert", competency:"innovation", bigFive:["O"], reverse:true },
          { text: "You discover a new tool that could help, but others are skeptical. What’s your move?", type:"scenario", competency:"innovation", bigFive:[], reverse:false },
          { text: "When facing a problem, I enjoy experimenting with multiple approaches before choosing one.", type:"likert", competency:"innovation", bigFive:["O"], reverse:false },
          { text: "You’re offered two paths: a safe option with predictable results, or a bold option with bigger upside. You choose:", type:"scenario", competency:"innovation", bigFive:["N"], reverse:false },
          { text: "I get energized by ambiguity because it gives room for creativity.", type:"likert", competency:"innovation", bigFive:["O"], reverse:false },
          { text: "When someone says 'that’s how we’ve always done it', I usually accept it without pushing much. (Subtle)", type:"likert", competency:"innovation", bigFive:["A"], reverse:true },
          { text: "You need a fresh idea, but data is incomplete. You:", type:"scenario", competency:"innovation", bigFive:[], reverse:false }
        ]
      },
      {
        id: "leadership",
        title: "Module 2 — Leadership",
        desc: "How you influence, take ownership, and move people toward outcomes.",
        questions: [
          { text: "Two teammates disagree strongly in front of the client. In the moment you:", type:"scenario", competency:"leadership", bigFive:["A"], reverse:false },
          { text: "I naturally step up to coordinate when no one is clearly leading.", type:"likert", competency:"leadership", bigFive:["E"], reverse:false },
          { text_ATTACHMENT: "A high-stakes task is late and everyone is stressed. You:", type:"scenario", competency:"leadership", bigFive:["N"], reverse:false },
          { text: "I avoid giving direct feedback because it can create tension. (Subtle)", type:"likert", competency:"leadership", bigFive:["A"], reverse:true },
          { text: "A junior colleague is underperforming but very motivated. Your first step is:", type:"scenario", competency:"leadership", bigFive:["A","C"], reverse:false },
          { text: "I set clear expectations and check progress without micromanaging.", type:"likert", competency:"leadership", bigFive:["C"], reverse:false },
          { text: "Your idea is rejected by the team. You:", type:"scenario", competency:"leadership", bigFive:["E"], reverse:false },
          { text: "I can stay calm and decisive when others feel uncertain.", type:"likert", competency:"leadership", bigFive:["N"], reverse:false },
          { text: "I prefer to wait for formal authority before acting. (Subtle)", type:"likert", competency:"leadership", bigFive:["E"], reverse:true },
          { text: "A project is failing. You realize your plan contributed to it. You:", type:"scenario", competency:"leadership", bigFive:["C"], reverse:false }
        ]
      },
      {
        id: "adaptability",
        title: "Module 3 — Adaptability",
        desc: "How you respond to change, uncertainty, and new constraints.",
        questions: [
          { text: "A priority changes suddenly after you’ve invested days of work. You:", type:"scenario", competency:"adaptability", bigFive:["N"], reverse:false },
          { text: "I can let go of old plans quickly if a better direction appears.", type:"likert", competency:"adaptability", bigFive:["O"], reverse:false },
          { text: "You join a project midstream with little documentation. Your approach is:", type:"scenario", competency:"adaptability", bigFive:["C"], reverse:false },
          { text: "When routines break, I tend to feel blocked and less productive. (Subtle)", type:"likert", competency:"adaptability", bigFive:["N"], reverse:true },
          { text: "A client adds an unexpected legal constraint. You:", type:"scenario", competency:"adaptability", bigFive:[], reverse:false },
          { text: "I enjoy learning new systems even when it slows me down temporarily.", type:"likert", competency:"adaptability", bigFive:["O"], reverse:false },
          { text: "Your plan fails due to external factors. You:", type:"scenario", competency:"adaptability", bigFive:["N"], reverse:false },
          { text: "I stay effective even when instructions are incomplete.", type:"likert", competency:"adaptability", bigFive:["C"], reverse:false },
          { text: "If rules change, I usually resist until I’m forced to adapt. (Subtle)", type:"likert", competency:"adaptability", bigFive:["A"], reverse:true },
          { text: "You move to a role that requires a skill you don’t yet master. You:", type:"scenario", competency:"adaptability", bigFive:[], reverse:false }
        ]
      },
      {
        id: "communication",
        title: "Module 4 — Communication",
        desc: "How clearly you share ideas, listen, and handle tough conversations.",
        questions: [
          { text: "A client misunderstands your message and gets upset. You:", type:"scenario", competency:"communication", bigFive:["A"], reverse:false },
          { text: "I ask clarifying questions before assuming I understand someone.", type:"likert", competency:"communication", bigFive:["A"], reverse:false },
          { text: "In a meeting, a senior person dominates and others go silent. You:", type:"scenario", competency:"communication", bigFive:["E"], reverse:false },
          { text: "I sometimes say less to avoid conflict, even if clarity suffers. (Subtle)", type:"likert", competency:"communication", bigFive:["N"], reverse:true },
          { text: "You must explain a complex topic to a non-expert. You:", type:"scenario", competency:"communication", bigFive:["O"], reverse:false },
          { text: "I adapt my communication style depending on who I’m speaking to.", type:"likert", competency:"communication", bigFive:["A"], reverse:false },
          { text: "A teammate gives you blunt feedback that feels unfair. You:", type:"scenario", competency:"communication", bigFive:["N"], reverse:false },
          { text: "I can disagree strongly while still making the other person feel respected.", type:"likert", competency:"communication", bigFive:["A"], reverse:false },
          { text: "I assume people will 'get it' without much context. (Subtle)", type:"likert", competency:"communication", bigFive:["C"], reverse:true },
          { text: "You notice a silent issue hurting performance, but no one talks about it. You:", type:"scenario", competency:"communication", bigFive:["E"], reverse:false }
        ]
      },
      {
        id: "workstyle",
        title: "Module 5 — Work Style",
        desc: "How you organize yourself, collaborate, and sustain results.",
        questions: [
          { text: "You have 3 urgent tasks and limited time. You:", type:"scenario", competency:"workstyle", bigFive:["C"], reverse:false },
          { text: "I prefer clear structure and timelines over flexible improvisation.", type:"likert", competency:"workstyle", bigFive:["C"], reverse:false },
          { text: "A teammate consistently delivers late but with high quality. You:", type:"scenario", competency:"workstyle", bigFive:["A"], reverse:false },
          { text: "I work best when I can decide priorities on the fly. (Subtle)", type:"likert", competency:"workstyle", bigFive:["O"], reverse:true },
          { text: "You’re asked to support two teams with different expectations. You:", type:"scenario", competency:"workstyle", bigFive:[], reverse:false },
          { text: "I follow through reliably, even on tasks that don’t excite me.", type:"likert", competency:"workstyle", bigFive:["C"], reverse:false },
          { text: "Work becomes repetitive for months. You:", type:"scenario", competency:"workstyle", bigFive:["O"], reverse:false },
          { text: "I feel comfortable working independently for long periods.", type:"likert", competency:"workstyle", bigFive:["E"], reverse:false },
          { text: "I sometimes miss details because I move fast. (Subtle)", type:"likert", competency:"workstyle", bigFive:["C"], reverse:true },
          { text: "A critical deadline is tomorrow and new info appears today. You:", type:"scenario", competency:"workstyle", bigFive:["N"], reverse:false }
        ]
      }
    ];

    const BIG5 = {
      O:"Openness",
      C:"Conscientiousness",
      E:"Extraversion",
      A:"Agreeableness",
      N:"Emotional Stability (low Neuroticism)"
    };

    const COMP_EXPLAIN = {
      innovation:"Innovation measures how you explore new ideas, challenge norms, and turn uncertainty into value. High scores suggest you actively seek improvements and creative paths. Lower scores indicate a preference for proven methods and stability.",
      leadership:"Leadership measures ownership, influence, and how you guide people toward outcomes. High scores indicate proactive direction, calm decision-making, and accountability. Lower scores may reflect a more individual-contributor or support-focused style.",
      adaptability:"Adaptability measures how you respond to change, new constraints, and shifting priorities. High scores suggest flexibility and learning agility. Lower scores can mean you thrive best with stable plans and predictable environments.",
      communication:"Communication measures clarity, listening, emotional tone, and how you handle tough conversations. High scores reflect effective alignment and trust-building. Lower scores might indicate you communicate more cautiously or indirectly.",
      workstyle:"Work Style measures organization, collaboration rhythm, and consistency under pressure. High scores indicate structured follow-through and sustainable execution. Lower scores may point to a more fluid, spontaneous, or speed-first approach."
    };

    const BIG5_EXPLAIN = {
      O:"Openness reflects curiosity, imagination, and comfort with new ideas. Higher scores mean you enjoy novelty and abstract thinking. Lower scores suggest practical focus and preference for tried-and-true approaches.",
      C:"Conscientiousness reflects reliability, planning, and self-discipline. Higher scores mean you naturally organize, follow through, and track details. Lower scores suggest flexibility and a preference for adapting as you go.",
      E:"Extraversion reflects social energy, assertiveness, and outward engagement. Higher scores mean you gain energy from interaction and speak up easily. Lower scores suggest you recharge privately and communicate more selectively.",
      A:"Agreeableness reflects cooperation, empathy, and trust. Higher scores mean you prioritize harmony and support others. Lower scores suggest you’re more direct, skeptical, or challenge ideas strongly.",
      N:"Emotional Stability reflects calmness under stress. Higher scores mean you manage pressure well and recover quickly. Lower scores suggest you feel stress more intensely and may need more certainty to stay at your best."
    };

    const startScreen = document.getElementById("startScreen");
    const testScreen = document.getElementById("testScreen");
    const resultsScreen = document.getElementById("resultsScreen");
    const questionWrap = document.getElementById("questionWrap");
    const moduleTitle = document.getElementById("moduleTitle");
    const moduleDesc = document.getElementById("moduleDesc");
    const progressFill = document.getElementById("progressFill");
    const progressText = document.getElementById("progressText");
    const timerEl = document.getElementById("timer");
    const timerWrap = document.getElementById("timerWrap");

    const resetModal = document.getElementById("resetModal");
    const modalOkBtn = document.getElementById("modalOkBtn");

    const startBtn = document.getElementById("startBtn");
    const previewBtn = document.getElementById("previewBtn");
    const modulesPreview = document.getElementById("modulesPreview");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");

    const downloadHtmlBtn = document.getElementById("downloadHtmlBtn");
    const downloadJsonBtn = document.getElementById("downloadJsonBtn");
    const restartBtn = document.getElementById("restartBtn");
    const candidateSummary = document.getElementById("candidateSummary");
    const competencyResults = document.getElementById("competencyResults");
    const personalityResults = document.getElementById("personalityResults");

    let flatQuestions = [];
    let currentIndex = 0;
    let answers = {};
    let candidate = null;

    let startTime = null;
    let timerInterval = null;

    function buildFlatQuestions(){
      flatQuestions = [];
      MODULES.forEach((m, mi) => {
        m.questions.forEach((q, qi) => {
          flatQuestions.push({
            ...q,
            moduleId: m.id,
            moduleTitle: m.title,
            moduleIndex: mi,
            questionIndexInModule: qi
          });
        });
      });
    }
    buildFlatQuestions();

    function showScreen(screen){
      [startScreen, testScreen, resultsScreen].forEach(s => s.classList.add("hidden"));
      screen.classList.remove("hidden");
    }

    previewBtn.addEventListener("click", () => {
      modulesPreview.classList.toggle("hidden");
      if (!modulesPreview.innerHTML){
        modulesPreview.innerHTML = MODULES.map(m =>
          `<div class="pill"><strong>${m.title}</strong><br>${m.desc}</div>`
        ).join("");
      }
    });

    startBtn.addEventListener("click", () => {
      const fullName = document.getElementById("fullName").value.trim();
      const role = document.getElementById("role").value.trim();
      const email = document.getElementById("email").value.trim();
      const consent = document.getElementById("consent").checked;

      if (!fullName || !role || !email || !consent) {
        alert("Please complete all fields and confirm consent.");
        return;
      }

      candidate = { fullName, role, email };
      answers = {};
      currentIndex = 0;

      startTimer();
      renderQuestion();
      showScreen(testScreen);
    });

    function startTimer(){
      startTime = Date.now();
      timerWrap.classList.remove("hidden");
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        const ms = Date.now() - startTime;
        timerEl.textContent = formatTime(ms);
      }, 250);
    }

    function stopTimer(){
      clearInterval(timerInterval);
    }

    function formatTime(ms){
      const totalSec = Math.floor(ms / 1000);
      const min = Math.floor(totalSec / 60).toString().padStart(2,"0");
      const sec = (totalSec % 60).toString().padStart(2,"0");
      return `${min}:${sec}`;
    }

    function hardResetDueToLeave(){
      stopTimer();
      showScreen(startScreen);
      resetModal.classList.remove("hidden");
    }

    document.addEventListener("visibilitychange", () => {
      if (document.hidden && startTime) hardResetDueToLeave();
    });
    window.addEventListener("blur", () => {
      if (startTime) hardResetDueToLeave();
    });
    modalOkBtn.addEventListener("click", ()=> resetModal.classList.add("hidden"));

    function renderQuestion(){
      const q = flatQuestions[currentIndex];
      const module = MODULES[q.moduleIndex];

      moduleTitle.textContent = module.title;
      moduleDesc.textContent = module.desc;

      const answeredValue = answers[currentIndex];

      const scaleLabels = [
        "Strongly Disagree",
        "Disagree",
        "Neutral",
        "Agree",
        "Strongly Agree"
      ];

      questionWrap.innerHTML = `
        <div class="q-card">
          <div class="q-meta">
            <span class="q-num">Q ${currentIndex + 1} of ${flatQuestions.length}</span>
            <span class="q-tag">${capitalize(q.competency)}${q.bigFive?.length ? " · Big Five" : ""}</span>
          </div>
          <div class="q-text">${q.text}</div>
          <div class="scale">
            ${scaleLabels.map((lab, i) => `
              <button type="button"
                      class="${answeredValue === i ? "selected" : ""}"
                      data-score="${i}">
                 ${lab}
              </button>
            `).join("")}
          </div>
          <p class="muted small">
            Choose the option that best reflects your true behavior, not what feels “ideal.”
          </p>
        </div>
      `;

      document.querySelectorAll(".scale button").forEach(btn => {
        btn.addEventListener("click", () => {
          const val = Number(btn.dataset.score);
          answers[currentIndex] = val;
          document.querySelectorAll(".scale button").forEach(b => b.classList.remove("selected"));
          btn.classList.add("selected");
          updateProgress();
        });
      });

      prevBtn.disabled = currentIndex === 0;
      nextBtn.textContent = currentIndex === flatQuestions.length - 1 ? "Finish" : "Next";

      updateProgress();
    }

    function updateProgress(){
      const done = Object.keys(answers).length;
      const total = flatQuestions.length;
      const pct = Math.round((done/total)*100);
      progressFill.style.width = pct + "%";
      progressText.textContent = `${done}/${total}`;
    }

    prevBtn.addEventListener("click", () => {
      if (currentIndex > 0){
        currentIndex--;
        renderQuestion();
      }
    });

    nextBtn.addEventListener("click", () => {
      if (answers[currentIndex] == null){
        alert("Please select an answer before continuing.");
        return;
      }

      if (currentIndex === flatQuestions.length - 1){
        finishTest();
      } else {
        currentIndex++;
        renderQuestion();
      }
    });

    function finishTest(){
      stopTimer();
      const elapsed = formatTime(Date.now() - startTime);

      const compScores = {innovation: [], leadership: [], adaptability: [], communication: [], workstyle: []};
      const bigScores = {O: [], C: [], E: [], A: [], N: []};

      flatQuestions.forEach((q, idx) => {
        let raw = answers[idx];
        if (q.reverse) raw = 4 - raw;
        compScores[q.competency].push(raw);
        (q.bigFive || []).forEach(trait => bigScores[trait].push(raw));
      });

      const compPct = {};
      for (const k in compScores){
        compPct[k] = (average(compScores[k]) / 4) * 100;
      }

      const bigPct = {};
      for (const t in bigScores){
        bigPct[t] = bigScores[t].length ? (average(bigScores[t]) / 4) * 100 : null;
      }

      candidateSummary.textContent =
        `${candidate.fullName} · Applying for: ${candidate.role} · ${candidate.email} · Time: ${elapsed}`;

      competencyResults.innerHTML = Object.keys(compPct).map(key =>
        resultCard(capitalize(key), compPct[key], COMP_EXPLAIN[key])
      ).join("");

      personalityResults.innerHTML = Object.keys(BIG5).map(t =>
        resultCard(BIG5[t], bigPct[t], BIG5_EXPLAIN[t], true)
      ).join("");

      const resultPayload = {
        candidate, elapsed,
        competencies: compPct,
        bigFive: bigPct,
        answers: flatQuestions.map((q, i) => ({
          module: q.moduleId,
          competency: q.competency,
          bigFive: q.bigFive,
          reverse: q.reverse,
          question: q.text,
          score: answers[i]
        }))
      };
      window.__LATEST_RESULTS__ = resultPayload;

      showScreen(resultsScreen);
    }

    function average(arr){
      return arr.reduce((a,b)=>a+b,0) / arr.length;
    }

    function capitalize(s){
      return s.charAt(0).toUpperCase() + s.slice(1);
    }

    function resultCard(title, pct, explain, isPersonality=false){
      if (pct == null){
        return `
          <div class="result-card">
            <div class="result-head">
              <div class="result-title">${title}</div>
              <div class="result-score muted">n/a</div>
            </div>
            <div class="result-explain muted">Not enough items to estimate.</div>
          </div>`;
      }
      const rounded = Math.round(pct);
      const label = isPersonality
        ? `${rounded}% expression`
        : `${rounded}% of ideal benchmark`;

      return `
        <div class="result-card">
          <div class="result-head">
            <div class="result-title">${title}</div>
            <div class="result-score">${label}</div>
          </div>
          <div class="result-bar"><div style="width:${rounded}%"></div></div>
          <div class="result-explain">${explain}</div>
        </div>`;
    }

    downloadJsonBtn.addEventListener("click", () => {
      const data = window.__LATEST_RESULTS__;
      const blob = new Blob([JSON.stringify(data, null, 2)], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      triggerDownload(url, `assessment_${slug(candidate.fullName)}.json`);
    });

    downloadHtmlBtn.addEventListener("click", () => {
      const data = window.__LATEST_RESULTS__;
      const html = buildPrintableHtml(data);
      const blob = new Blob([html], {type:"text/html"});
      const url = URL.createObjectURL(blob);
      triggerDownload(url, `assessment_${slug(candidate.fullName)}.html`);
    });

    function triggerDownload(url, filename){
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    function slug(s){
      return s.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_|_$/g,"");
    }

    function buildPrintableHtml(data){
      const {candidate, elapsed, competencies, bigFive} = data;

      const compRows = Object.keys(competencies).map(k => `
        <tr>
          <td>${capitalize(k)}</td>
          <td>${Math.round(competencies[k])}%</td>
          <td>${COMP_EXPLAIN[k]}</td>
        </tr>
      `).join("");

      const bigRows = Object.keys(BIG5).map(t => `
        <tr>
          <td>${BIG5[t]}</td>
          <td>${Math.round(bigFive[t] ?? 0)}%</td>
          <td>${BIG5_EXPLAIN[t]}</td>
        </tr>
      `).join("");

      return `
<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Assessment Results</title>
  <style>
    body{font-family:Inter,Arial,sans-serif;padding:24px;color:#111;}
    h1{margin-top:0;}
    table{width:100%;border-collapse:collapse;margin:10px 0 18px;}
    th,td{border:1px solid #ddd;padding:8px;vertical-align:top;}
    th{background:#f3f4f6;text-align:left;}
    .meta{color:#374151;margin-bottom:10px;}
    .pill{display:inline-block;background:#ecfdf5;color:#065f46;padding:4px 8px;border-radius:999px;font-weight:700;font-size:12px;}
  </style>
</head>
<body>
  <h1>Sineva Assessment Results</h1>
  <div class="meta">
    <div><strong>Name:</strong> ${candidate.fullName}</div>
    <div><strong>Role:</strong> ${candidate.role}</div>
    <div><strong>Email:</strong> ${candidate.email}</div>
    <div><strong>Elapsed time:</strong> ${elapsed}</div>
  </div>

  <h2><span class="pill">Competencies</span></h2>
  <table>
    <thead><tr><th>Competency</th><th>Score</th><th>Meaning</th></tr></thead>
    <tbody>${compRows}</tbody>
  </table>

  <h2><span class="pill">Big Five Personality</span></h2>
  <table>
    <thead><tr><th>Trait</th><th>Expression</th><th>Meaning</th></tr></thead>
    <tbody>${bigRows}</tbody>
  </table>

  <p><em>These results are indicators, not verdicts. They help us understand fit, strengths, and preferred styles.</em></p>
</body>
</html>`;
    }

    restartBtn.addEventListener("click", () => location.reload());
  </script>
</body>
</html>
