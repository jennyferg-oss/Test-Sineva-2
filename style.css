// ===== MODULE STRUCTURE =====

// Temporary test module questions to confirm the flow works
const modules = [
    { name: "Module A", questions: ["A1?", "A2?", "A3?", "A4?", "A5?", "A6?", "A7?", "A8?", "A9?", "A10?"] },
    { name: "Module B", questions: ["B1?", "B2?", "B3?", "B4?", "B5?", "B6?", "B7?", "B8?", "B9?", "B10?"] },
    { name: "Module C", questions: ["C1?", "C2?", "C3?", "C4?", "C5?", "C6?", "C7?", "C8?", "C9?", "C10?"] },
    { name: "Module D", questions: ["D1?", "D2?", "D3?", "D4?", "D5?", "D6?", "D7?", "D8?", "D9?", "D10?"] },
    { name: "Module E", questions: ["E1?", "E2?", "E3?", "E4?", "E5?", "E6?", "E7?", "E8?", "E9?", "E10?"] }
];

// ===== DOM ELEMENTS =====
const modulePage = document.getElementById("module-page");
const testPage = document.getElementById("test-page");
const resultsPage = document.getElementById("results-page");

const questionText = document.getElementById("question-text");
const questionNumber = document.getElementById("question-number");
const optionsContainer = document.getElementById("options-container");
const nextButton = document.getElementById("next-button");
const timerDisplay = document.getElementById("timer");

let currentModule = 0;
let currentQuestion = 0;
let timer;
let timeLeft = 420; // 7 minutes in seconds

// ===== MODULE CLICK =====
document.querySelectorAll(".module-button").forEach(btn => {
    btn.addEventListener("click", () => {
        const moduleIndex = parseInt(btn.dataset.module);

        // enforce correct order
        if (moduleIndex !== currentModule) {
            alert("You must complete the modules in order.");
            return;
        }

        startModule(moduleIndex);
    });
});

// ===== START MODULE =====
function startModule(index) {
    modulePage.classList.add("hidden");
    testPage.classList.remove("hidden");

    currentModule = index;
    currentQuestion = 0;

    startTimer();
    loadQuestion();
}

// ===== TIMER =====
function startTimer() {
    timeLeft = 420;
    timerDisplay.textContent = "Time Left: 07:00";

    timer = setInterval(() => {
        timeLeft--;

        let min = Math.floor(timeLeft / 60);
        let sec = timeLeft % 60;
        if (sec < 10) sec = "0" + sec;

        timerDisplay.textContent = `Time Left: ${min}:${sec}`;

        if (timeLeft <= 0) {
            clearInterval(timer);
            nextModule();
        }
    }, 1000);
}

// ===== LOAD QUESTION =====
function loadQuestion() {
    const m = modules[currentModule];
    const q = m.questions[currentQuestion];

    questionText.textContent = q;
    questionNumber.textContent = `Question ${currentQuestion + 1} of 10`;

    optionsContainer.innerHTML = "";
    nextButton.disabled = true;

    ["Option 1", "Option 2", "Option 3", "Option 4"].forEach(opt => {
        const div = document.createElement("div");
        div.classList.add("option");
        div.textContent = opt;
        div.onclick = () => {
            document.querySelectorAll(".option").forEach(o => o.classList.remove("selected"));
            div.classList.add("selected");
            nextButton.disabled = false;
        };
        optionsContainer.appendChild(div);
    });
}

// ===== NEXT QUESTION =====
nextButton.addEventListener("click", () => {
    currentQuestion++;

    if (currentQuestion >= 10) {
        nextModule();
    } else {
        loadQuestion();
    }
});

// ===== MOVE TO NEXT MODULE =====
function nextModule() {
    clearInterval(timer);

    currentModule++;

    if (currentModule >= modules.length) {
        showResults();
    } else {
        modulePage.classList.remove("hidden");
        testPage.classList.add("hidden");
    }
}

// ===== RESULTS =====
function showResults() {
    testPage.classList.add("hidden");
    resultsPage.classList.remove("hidden");

    document.getElementById("final-score").innerHTML =
        `<h3>Test Completed</h3><p>Your full scoring will appear here after final integration.</p>`;
}
